@page
@model HelpdeskSystem.Pages.Tickets.IndexModel
@{
    ViewData["Title"] = "Tickets";
    var currentUserId = User.FindFirst(System.Security.Claims.ClaimTypes.NameIdentifier)?.Value;
}

<!-- PAGE HEADER -->
<div class="d-flex justify-content-between align-items-center mb-4">
    <div>
        <h2 class="fw-bold mb-0">🎫 Tickets</h2>
        <small class="text-muted">
            Manage and track your support requests
        </small>
    </div>

    <a asp-page="Create" class="btn btn-primary btn-sm">
        ➕ Create Ticket
    </a>
</div>

<!-- TICKETS TABLE -->
<div class="card shadow-sm">
    <div class="card-body p-0">

        <table class="table table-hover align-middle mb-0">
            <thead class="table-light">
                <tr>
                    <th>Title</th>
                    <th>Status</th>
                    <th>Created On</th>
                    <th style="width:230px;">Actions</th>
                </tr>
            </thead>

            <tbody>
                @foreach (var ticket in Model.Tickets)
                {
                    <tr>
                        <td class="fw-semibold">@ticket.Title</td>

                        <td>
                            <span class="badge
                                @(ticket.Status == "Open" ? "bg-warning" :
                                  ticket.Status == "Resolved" ? "bg-success" :
                                  "bg-secondary")">
                                @ticket.Status
                            </span>
                        </td>

                        <td>@ticket.CreatedOn.ToString("dd-MMM-yyyy")</td>

                        <td class="d-flex gap-2">

                            <!-- DETAILS: Everyone -->
                            <a asp-page="Details"
                               asp-route-id="@ticket.Id"
                               class="btn btn-outline-info btn-sm">
                                Details
                            </a>

                            @if (ticket.CreatedBy == currentUserId || User.IsInRole("Admin"))
                            {
                                <a asp-page="Edit"
                                   asp-route-id="@ticket.Id"
                                   class="btn btn-outline-warning btn-sm">
                                    Edit
                                </a>

                                <a asp-page="Delete"
                                   asp-route-id="@ticket.Id"
                                   class="btn btn-outline-danger btn-sm">
                                    Delete
                                </a>
                            }
                        </td>
                    </tr>
                }
            </tbody>
        </table>

        @if (!Model.Tickets.Any())
        {
            <div class="text-center text-muted py-4">
                No tickets found. Click <strong>Create Ticket</strong> to get started.
            </div>
        }
    </div>
</div>